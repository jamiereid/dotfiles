#
# Jambulance's theme
#
# Author:
#   Jamie Reid <jamie@jre.id.au>
#

pmodload 'helper'

function prompt_jambulance_pwd {
  setopt PROMPT_SUBST

  local pwd="${PWD/#$HOME/~}"

  if [[ "$pwd" == (#m)[/~] ]]; then
    _prompt_jambulance_pwd="$MATCH"
    unset MATCH
  else
    _prompt_jambulance_pwd="%{%F{166}%}${${(%):-%~}//\//%F{166\}/%f}%f"
  fi
}

function prompt_jambulance_precmd {
   setopt LOCAL_OPTIONS
   unsetopt XTRACE KSH_ARRAYS

   prompt_jambulance_pwd
}

function prompt_jambulance_setup {
  setopt LOCAL_OPTIONS
  unsetopt XTRACE KSH_ARRAYS
  prompt_opts=(cr percent subst)

  # Load required functions
  autoload -Uz add-zsh-hook

  # Add hook for calling vcs_info before each command.
  add-zsh-hook precmd prompt_jambulance_precmd

  # Add hook for calling things before each command
  add-zsh-hook precmd prompt_jambulance_precmd

  # Define prompts.
  PROMPT='%F{136}(%f${_prompt_jambulance_pwd}%F{136})%f%F{166}Â»%f '
  RPROMPT='%F{243}%n@%m%f'
  SPROMPT='zsh: correct %F{red}%R%f to %F{green}%r%f [nyae]? '
}

prompt_jambulance_setup "$@"

